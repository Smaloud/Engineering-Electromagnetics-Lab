<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>case2</title>
<meta name="generator" content="MATLAB 23.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2024-05-18">
<meta name="DC.source" content="case2.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Initialization</a>
</li>
<li>
<a href="#2">Declarations</a>
</li>
<li>
<a href="#3">Magnetic Field Intensity Vector Distribution</a>
</li>
<li>
<a href="#4">Magnetic Field Intensity Magnitude Distribution</a>
</li>
<li>
<a href="#5">Magnetic Line Distribution</a>
</li>
</ul>
</div>
<h2 id="1">Initialization</h2>
<pre class="codeinput">clear;
clc;
</pre>
<h2 id="2">Declarations</h2>
<p>Basic Parameters</p>
<pre class="codeinput">a = 2;   <span class="comment">% m</span>
I = 500; <span class="comment">% A</span>
d = 2;   <span class="comment">% m</span>
<span class="comment">% Scene</span>
segment_number = 50;
segment_length = 2 * pi * a / segment_number;
angles = linspace(0, 2 * pi, segment_number);
<span class="comment">% Viewport</span>
sampling_density = 10;
length_y = 6;
length_z = 3;
sampling_number_y = sampling_density * length_y + 1;
sampling_number_z = sampling_density * length_z + 1;
range_y = linspace(-length_y / 2, length_y / 2, sampling_number_y);
range_z = linspace(-length_z / 2, length_z / 2, sampling_number_z);
</pre>
<h2 id="3">Magnetic Field Intensity Vector Distribution</h2>
<pre class="codeinput">Hy = zeros(sampling_number_y, sampling_number_z);
Hz = zeros(sampling_number_y, sampling_number_z);
<span class="comment">% Iterate the mesh points</span>
<span class="keyword">for</span> it_y = 1 : sampling_number_y
    <span class="keyword">for</span> it_z = 1 : sampling_number_z
        <span class="comment">% Obtain real position of the mesh point</span>
        P = [0, <span class="keyword">...</span>
            (it_y - 1) / sampling_density - length_y / 2, <span class="keyword">...</span>
            (it_z - 1) / sampling_density - length_z / 2];
        <span class="comment">% Iterate the loops</span>
        <span class="keyword">for</span> S_z = [-d / 2, d / 2]
            <span class="comment">% Iterate the segments</span>
            <span class="keyword">for</span> S_angle = angles(1 : segment_number)
                <span class="comment">% Obtain the position of current segment</span>
                S = [a * cos(S_angle), a * sin(S_angle), S_z];
                <span class="comment">% Obtain the displacement</span>
                R = P - S;
                <span class="comment">% Obtain the differential length</span>
                dL = [-segment_length * sin(S_angle), segment_length * cos(S_angle), 0] * sign(S_z);
                <span class="comment">% Apply Biot&ndash;Savart Law</span>
                dH = cross(I .* dL, R) ./ (4 .* pi .* norm(R) .^ 3);
                <span class="comment">% Accumulate</span>
                Hy(it_y, it_z) = Hy(it_y, it_z) + dH(2);
                Hz(it_y, it_z) = Hz(it_y, it_z) + dH(3);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% Plot the figure</span>
figure(1);
grid <span class="string">on</span>, axis <span class="string">equal</span>, hold <span class="string">on</span>;
[mesh_y, mesh_z] = meshgrid(range_y, range_z);
quiver(mesh_y, mesh_z, Hy', Hz');
plot(a, d / 2, <span class="string">'ro'</span>, -a, d / 2, <span class="string">'bo'</span>, a, -d / 2, <span class="string">'ro'</span>, -a, -d / 2, <span class="string">'bo'</span>);
plot([a, -a], [d / 2, d / 2], <span class="string">'b-'</span>, [-a, -a], [d / 2, -d / 2], <span class="string">'g--'</span>, [-a, a], [-d / 2, -d / 2], <span class="string">'b-'</span>, [a, a], [-d / 2, d / 2], <span class="string">'g--'</span>)
axis([-length_y / 2, length_y / 2, -length_z / 2, length_z / 2]);
set(gcf, <span class="string">'Position'</span>, [50, 50, 900, 600]);
title([<span class="string">"Magnetic Field Intensity Vector Distribution"</span>, <span class="string">"(Gan Yuhao, 12211629)"</span>]);
xlabel(<span class="string">"y (m)"</span>), ylabel(<span class="string">"z (m)"</span>);
saveas(1, <span class="string">"Magnetic Field Intensity Vector Distribution 2"</span>,<span class="string">"png"</span>);
</pre>
<img vspace="5" hspace="5" src="case2_01.png" alt=""> <h2 id="4">Magnetic Field Intensity Magnitude Distribution</h2>
<pre class="codeinput">H_norm = sqrt(Hy .^ 2 + Hz .^ 2);

<span class="comment">% Plot the figure</span>
figure(2);
grid <span class="string">on</span>, axis <span class="string">equal</span>, hold <span class="string">on</span>;
[mesh_y, mesh_z] = meshgrid(range_y, range_z);
mesh(mesh_y, mesh_z, H_norm');
axis([-length_y / 2, length_y / 2, -length_z / 2, length_z / 2, 0, 500]);
set(gcf, <span class="string">'Position'</span>, [50, 50, 400, 700]);
view([3, 3, 200]);
title([<span class="string">"Magnetic Field Intensity Magnitude Distribution"</span>, <span class="string">"(Gan Yuhao, 12211629)"</span>]);
xlabel(<span class="string">"y (m)"</span>), ylabel(<span class="string">"z (m)"</span>), zlabel(<span class="string">"|H| (A/m)"</span>);
saveas(2, <span class="string">" Magnetic Field Intensity Magnitude Distribution 2"</span> , <span class="string">"png"</span>);
</pre>
<img vspace="5" hspace="5" src="case2_02.png" alt=""> <h2 id="5">Magnetic Line Distribution</h2>
<p>Sample the magnitude of H</p>
<pre class="codeinput">H_samples_range_y = [-a, a];
H_samples_z = d / 2;
H_samples_index_y = floor((H_samples_range_y(1) + length_y / 2) * sampling_density) : floor((H_samples_range_y(2) + length_y / 2) * sampling_density);
H_samples_index_z = floor((length_z / 2 + H_samples_z) * sampling_density);
H_samples = H_norm(H_samples_index_y, H_samples_index_z);

<span class="comment">% Calculate PDF &amp; CDF</span>
H_pdf = H_samples ./ sum(H_samples);
H_cdf = zeros(1, length(H_pdf));
H_cdf(1) = H_pdf(1);
<span class="keyword">for</span> it = 2 : length(H_pdf)
    H_cdf(it) = H_cdf(it - 1) + H_pdf(it);
<span class="keyword">end</span>

<span class="comment">% Sample basing on PDF &amp; CDF</span>
line_number = 28;
line_start_y = zeros(1, line_number);
line_start_z = zeros(1, line_number);
uniform_samples = linspace(0.012, 0.99, line_number);
<span class="keyword">for</span> it_u = 1 : line_number
    u = uniform_samples(it_u);
    <span class="keyword">if</span> u &lt; H_cdf(1)
        left = 0;
        right = H_samples_range_y(1);
    <span class="keyword">else</span>
        <span class="keyword">for</span> it_s = 1 : (length(H_cdf) - 1)
            <span class="keyword">if</span> u &gt;= H_cdf(it_s) &amp;&amp; u &lt; H_cdf(it_s + 1)
                delta = (H_samples_range_y(2) - H_samples_range_y(1)) / length(H_cdf);
                left = H_samples_range_y(1) + delta * (it_s - 1);
                right = H_samples_range_y(1) + delta * it_s;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    line_start_y(it_u) = (left + right) / 2;
    line_start_z(it_u) = H_samples_z;
<span class="keyword">end</span>

<span class="comment">% Plot the figure</span>
figure(3);
grid <span class="string">on</span>, axis <span class="string">equal</span>, hold <span class="string">on</span>;
[mesh_y, mesh_z] = meshgrid(range_y, range_z);
fig_sl = streamline(mesh_y, mesh_z, -Hy', -Hz', line_start_y, line_start_z);
set(fig_sl, <span class="string">"lineWidth"</span>, 0.4, <span class="string">"color"</span>, [0.9, 0.4, 0.8]);
fig_sl = streamline(mesh_y, mesh_z, Hy', Hz', line_start_y, line_start_z);
set(fig_sl, <span class="string">"lineWidth"</span>, 0.4, <span class="string">"color"</span>, [0.9, 0.4, 0.8]);
fig_sl = streamline(mesh_y, mesh_z, -Hy', -Hz', line_start_y, -line_start_z);
set(fig_sl, <span class="string">"lineWidth"</span>, 0.4, <span class="string">"color"</span>, [0.9, 0.4, 0.8]);
fig_sl = streamline(mesh_y, mesh_z, Hy', Hz', line_start_y, -line_start_z);
set(fig_sl, <span class="string">"lineWidth"</span>, 0.4, <span class="string">"color"</span>, [0.9, 0.4, 0.8]);
plot(a, d / 2, <span class="string">'ro'</span>, -a, d / 2, <span class="string">'bo'</span>, a, -d / 2, <span class="string">'ro'</span>, -a, -d / 2, <span class="string">'bo'</span>);
plot([a, -a], [d / 2, d / 2], <span class="string">'b-'</span>, [-a, -a], [d / 2, -d / 2], <span class="string">'g--'</span>, [-a, a], [-d / 2, -d / 2], <span class="string">'b-'</span>, [a, a], [-d / 2, d / 2], <span class="string">'g--'</span>)
axis([-length_y / 2, length_y / 2, -length_z / 2, length_z / 2]);
set(gcf, <span class="string">'Position'</span>, [50, 50, 900, 600]);
title([<span class="string">"Magnetic Line Distribution"</span>, <span class="string">"(Gan Yuhao, 12211629)"</span>]);
xlabel(<span class="string">"y (m)"</span>), ylabel(<span class="string">"z (m)"</span>);
saveas(3, <span class="string">"Magnetic Line Distribution 2"</span> , <span class="string">"png"</span>);
</pre>
<img vspace="5" hspace="5" src="case2_03.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Initialization
clear;
clc;

%% Declarations
% Basic Parameters
a = 2;   % m
I = 500; % A
d = 2;   % m
% Scene
segment_number = 50;
segment_length = 2 * pi * a / segment_number;
angles = linspace(0, 2 * pi, segment_number);
% Viewport
sampling_density = 10;
length_y = 6;
length_z = 3;
sampling_number_y = sampling_density * length_y + 1;
sampling_number_z = sampling_density * length_z + 1;
range_y = linspace(-length_y / 2, length_y / 2, sampling_number_y);
range_z = linspace(-length_z / 2, length_z / 2, sampling_number_z);

%% Magnetic Field Intensity Vector Distribution
Hy = zeros(sampling_number_y, sampling_number_z);
Hz = zeros(sampling_number_y, sampling_number_z);
% Iterate the mesh points
for it_y = 1 : sampling_number_y
    for it_z = 1 : sampling_number_z
        % Obtain real position of the mesh point
        P = [0, ...
            (it_y - 1) / sampling_density - length_y / 2, ... 
            (it_z - 1) / sampling_density - length_z / 2];
        % Iterate the loops
        for S_z = [-d / 2, d / 2]
            % Iterate the segments
            for S_angle = angles(1 : segment_number)
                % Obtain the position of current segment
                S = [a * cos(S_angle), a * sin(S_angle), S_z];
                % Obtain the displacement
                R = P - S;
                % Obtain the differential length
                dL = [-segment_length * sin(S_angle), segment_length * cos(S_angle), 0] * sign(S_z);
                % Apply Biot–Savart Law
                dH = cross(I .* dL, R) ./ (4 .* pi .* norm(R) .^ 3);
                % Accumulate
                Hy(it_y, it_z) = Hy(it_y, it_z) + dH(2);
                Hz(it_y, it_z) = Hz(it_y, it_z) + dH(3);
            end
        end
    end
end

% Plot the figure
figure(1);
grid on, axis equal, hold on;
[mesh_y, mesh_z] = meshgrid(range_y, range_z);
quiver(mesh_y, mesh_z, Hy', Hz');
plot(a, d / 2, 'ro', -a, d / 2, 'bo', a, -d / 2, 'ro', -a, -d / 2, 'bo');
plot([a, -a], [d / 2, d / 2], 'b-', [-a, -a], [d / 2, -d / 2], 'gREPLACE_WITH_DASH_DASH', [-a, a], [-d / 2, -d / 2], 'b-', [a, a], [-d / 2, d / 2], 'gREPLACE_WITH_DASH_DASH')
axis([-length_y / 2, length_y / 2, -length_z / 2, length_z / 2]);
set(gcf, 'Position', [50, 50, 900, 600]);
title(["Magnetic Field Intensity Vector Distribution", "(Gan Yuhao, 12211629)"]);
xlabel("y (m)"), ylabel("z (m)");
saveas(1, "Magnetic Field Intensity Vector Distribution 2","png");
%% Magnetic Field Intensity Magnitude Distribution
H_norm = sqrt(Hy .^ 2 + Hz .^ 2);

% Plot the figure
figure(2);
grid on, axis equal, hold on;
[mesh_y, mesh_z] = meshgrid(range_y, range_z);
mesh(mesh_y, mesh_z, H_norm');
axis([-length_y / 2, length_y / 2, -length_z / 2, length_z / 2, 0, 500]);
set(gcf, 'Position', [50, 50, 400, 700]);
view([3, 3, 200]);
title(["Magnetic Field Intensity Magnitude Distribution", "(Gan Yuhao, 12211629)"]);
xlabel("y (m)"), ylabel("z (m)"), zlabel("|H| (A/m)");
saveas(2, " Magnetic Field Intensity Magnitude Distribution 2" , "png");
%% Magnetic Line Distribution
% Sample the magnitude of H
H_samples_range_y = [-a, a];
H_samples_z = d / 2;
H_samples_index_y = floor((H_samples_range_y(1) + length_y / 2) * sampling_density) : floor((H_samples_range_y(2) + length_y / 2) * sampling_density);
H_samples_index_z = floor((length_z / 2 + H_samples_z) * sampling_density);
H_samples = H_norm(H_samples_index_y, H_samples_index_z);

% Calculate PDF & CDF
H_pdf = H_samples ./ sum(H_samples);
H_cdf = zeros(1, length(H_pdf));
H_cdf(1) = H_pdf(1);
for it = 2 : length(H_pdf)
    H_cdf(it) = H_cdf(it - 1) + H_pdf(it);
end

% Sample basing on PDF & CDF
line_number = 28;
line_start_y = zeros(1, line_number);
line_start_z = zeros(1, line_number);
uniform_samples = linspace(0.012, 0.99, line_number);
for it_u = 1 : line_number
    u = uniform_samples(it_u);
    if u < H_cdf(1)
        left = 0;
        right = H_samples_range_y(1);
    else
        for it_s = 1 : (length(H_cdf) - 1)
            if u >= H_cdf(it_s) && u < H_cdf(it_s + 1)
                delta = (H_samples_range_y(2) - H_samples_range_y(1)) / length(H_cdf);
                left = H_samples_range_y(1) + delta * (it_s - 1);
                right = H_samples_range_y(1) + delta * it_s;
            end
        end
    end
    line_start_y(it_u) = (left + right) / 2;
    line_start_z(it_u) = H_samples_z;
end

% Plot the figure
figure(3);
grid on, axis equal, hold on;
[mesh_y, mesh_z] = meshgrid(range_y, range_z);
fig_sl = streamline(mesh_y, mesh_z, -Hy', -Hz', line_start_y, line_start_z);
set(fig_sl, "lineWidth", 0.4, "color", [0.9, 0.4, 0.8]);
fig_sl = streamline(mesh_y, mesh_z, Hy', Hz', line_start_y, line_start_z);
set(fig_sl, "lineWidth", 0.4, "color", [0.9, 0.4, 0.8]);
fig_sl = streamline(mesh_y, mesh_z, -Hy', -Hz', line_start_y, -line_start_z);
set(fig_sl, "lineWidth", 0.4, "color", [0.9, 0.4, 0.8]);
fig_sl = streamline(mesh_y, mesh_z, Hy', Hz', line_start_y, -line_start_z);
set(fig_sl, "lineWidth", 0.4, "color", [0.9, 0.4, 0.8]);
plot(a, d / 2, 'ro', -a, d / 2, 'bo', a, -d / 2, 'ro', -a, -d / 2, 'bo');
plot([a, -a], [d / 2, d / 2], 'b-', [-a, -a], [d / 2, -d / 2], 'gREPLACE_WITH_DASH_DASH', [-a, a], [-d / 2, -d / 2], 'b-', [a, a], [-d / 2, d / 2], 'gREPLACE_WITH_DASH_DASH')
axis([-length_y / 2, length_y / 2, -length_z / 2, length_z / 2]);
set(gcf, 'Position', [50, 50, 900, 600]);
title(["Magnetic Line Distribution", "(Gan Yuhao, 12211629)"]);
xlabel("y (m)"), ylabel("z (m)");
saveas(3, "Magnetic Line Distribution 2" , "png");

##### SOURCE END #####
-->
</body>
</html>
